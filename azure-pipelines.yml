trigger:
- master

pool:
  vmImage: 'windows-latest'

variables:
  qaFrontendAppName: 'blogapi-front-qa'
  qaBackendAppName: 'blogapi-back-qa'
  qaFrontendUrl: 'https://blogapi-front-qa-bhd4cqfxd0ejegd5.canadacentral-01.azurewebsites.net/'
  prodFrontendAppName: 'blogapi-front-prod'
  prodBackendAppName: 'blogapi-back-prod'
            - task: PublishBuildArtifacts@1
            displayName: 'Publish Backend Artifacts'
            inputs:
              publishLocation: 'Container'
              artifactName: 'backendBuild'
              targetPath: $(Build.ArtifactStagingDirectory)/backendBuild

          - task: DownloadBuildArtifacts@0
            displayName: 'Download Backend Artifacts'
            inputs:
              buildType: 'current'
              artifactName: 'backendBuild'
              downloadPath: $(Build.ArtifactStagingDirectory)
          - script: echo $(Build.ArtifactStagingDirectory)
            displayName: 'Show Artifact Staging Directory'

          - task: AzureWebApp@1
            displayName: 'Deploy Backend to QA'
            inputs:
              azureSubscription: 'Student-Subs'
              appName: $(qaBackendAppName)
              package: $(Build.ArtifactStagingDirectory)/backendBuild
 
                # Descargamos los artefactos del backend
                - task: DownloadBuildArtifacts@0
                  displayName: 'Download Backend Artifacts'
                  inputs:
                    buildType: 'current'
                    artifactName: 'backendBuild'
                    downloadPath: $(Build.ArtifactStagingDirectory)

                - script: echo $(Build.ArtifactStagingDirectory)
                  displayName: 'Show Artifact Staging Directory'

                # Desplegar el backend a producci√≥n
                - task: AzureWebApp@1
                  displayName: 'Deploy Backend to Prod'
                  inputs:
                    azureSubscription: 'Student-Subs'
                    appName: $(prodBackendAppName)
                    package: $(Build.ArtifactStagingDirectory)/backendBuild


